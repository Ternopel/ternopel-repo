<script src='/javascript/imagecrop.min.js'></script>
<script src='/javascript/crud.js'></script>
<script src='/javascript/products.js'></script>
<section class="page-container clear-fix">
	{{#def.load('admin_menu.html')}}
	<section class="main-content">
		<input type='hidden' name='_csrf' value='{{=it.csrfToken}}'>

		<input type="hidden" name="picture_type" id="picture_type" />
		<input type="hidden" name="picture_data" id="picture_data" />		
		
		<h1>Gestión de Productos</h1>
		<input type='text' name='search' placeholder='Ingrese búsqueda' value='{{=it.search}}'>
		<input type='button' id='addProduct' value='Agregar Producto' ></input>
		<br/>
		<table id='productsTable' summary='/admin/products'>
			<tr>
				<th><h4>Descripción</h4></th>
				<th><h4>Url</h4></th>
				<th><h4>Categoría</h4></th>
				<th><h4>Packaging</h4></th>
				<th><h4>Visible</h4></th>
				<th><h4>Oferta</h4></th>
				<th><h4></h4></th>
				<th><h4></h4></th>
			</tr>
			{{~ it.products:product}}
			<tr name='{{=product.id}}'>
				<td name='name' style='width: 500px;'><span>{{=product.name}}</span></td>
				<td name='url' style='width: 500px;'><span>{{=product.url}}</span></td>
				<td name='category_id' style='width: 500px;'>
					<select>
						{{~ it.categories:category}}
							{{? category.id === product.category_id}}
								<option value="{{=category.id}}" selected="selected">{{=category.name}}</option>
							{{??}}
								<option value="{{=category.id}}">{{=category.name}}</option>
							{{?}}
						{{~}}
					</select> 				
				<td name='packaging_id' style='width: 500px;'>
					<select>
						{{~ it.packaging:packaging}}
							{{? packaging.id === product.packaging_id}}
								<option value="{{=packaging.id}}" selected="selected">{{=packaging.name}}</option>
							{{??}}
								<option value="{{=packaging.id}}">{{=packaging.name}}</option>
							{{?}}
						{{~}}
					</select> 				
				</td>
				<td name='is_visible' style="width:290px;">
					{{? product.is_visible === true}}
						<input type='checkbox' name='isvisible1' checked='checked'>&nbsp;Visible</input>
					{{??}}
						<input type='checkbox' name='isvisible1'>&nbsp;Visible</input>
					{{?}}
				</td>
				<td name='is_offer' style="width:290px;">
					{{? product.is_offer === true}}
						<input type='checkbox' name='isoffer1' checked='checked'>&nbsp;Oferta</input>
					{{??}}
						<input type='checkbox' name='isoffer1'>&nbsp;Oferta</input>
					{{?}}
				</td>
				<td name='show_format' style="width:290px;">
					{{? product.show_format === true}}
						<input type='checkbox' name='formatscheck1' checked='checked'>&nbsp;Form.</input>
					{{??}}
						<input type='checkbox' name='formatscheck1'>&nbsp;Form.</input>
					{{?}}
				</td>
				<td name='show_picture' style="width:290px;">
					<input type='checkbox' id='showpicture_{{=product.id}}' name='showpicturebutton'>&nbsp;Img.</input>
				</td>
				<td><input name='remove' type='button' value='Borrar'></input></td>
			</tr>
			{{? product.show_format === true}}
			<tr name='{{=product.id}}_format'>
			{{??}}
			<tr name='{{=product.id}}_format' style='display:none;'>
			{{?}}
				<td colspan="4">
					<br/>
					<input type='button' id='addProductFormat' name='{{=product.id}}' value='Agregar Formato' ></input>
					<br/>
					<table id='productsFormatsTable' summary='/admin/productsformats'>
						<tr>
							<th><h4>Formato</h4></th>
							<th><h4>Unidades</h4></th>
							<th><h4>Cantidad</h4></th>
							<th><h4>Precio Por Menor</h4></th>
							<th><h4>Precio Por Mayor</h4></th>
							<th><h4></h4></th>
						</tr>
						{{~ product.productsformats:productformat}}
						<tr name='{{=productformat.id}}'>
							<td name='format' style='width: 500px;'><span>{{=productformat.format}}</span></td>
							<td name='units' style='width: 500px;'><span>{{=productformat.units}}</span></td>
							<td name='quantity' style='width: 500px;'><span>{{=productformat.quantity}}</span></td>
							<td name='retail' style='width: 500px;'><span>{{=productformat.retail}}</span></td>
							<td name='wholesale' style='width: 500px;'><span>{{=productformat.wholesale}}</span></td>
							<td><input name='remove' type='button' value='Borrar'></input></td>
						</tr>
						{{~}}
					</table>
				</td>
			</tr>
			<tr name='{{=product.id}}_picture' style='display:none;'>
				<td colspan="4">
					<div name="{{=product.id}}-upload-photo-container" class="upload-photo-container"> 
						<div name="{{=product.id}}-imageBox" class="imageBox">
							<div name="{{=product.id}}-thumbBox" class="thumbBox"></div>
							<div name="{{=product.id}}-spinner" class="spinner" style="display:none">Cargando...</div>
						</div>
						<div class="action clear-fix">
							<span name="{{=product.id}}-upload-btn" class="upload-btn"><span name="{{=product.id}}-upload-label" class="upload-label">Subir foto</span><input type="file" name="{{=product.id}}-picture" accept="image/*" /></span>
							<span name="{{=product.id}}-save-span" class="change-btn" style="display:none"><span class="upload-label">Grabar foto</span><input type="button" name="{{=product.id}}-save"/></span>
							<input type="button" class="crop-btn" name="{{=product.id}}-btnCrop" value="Crop" style="float: right;display:none">
							<input type="button" class="zoom-in-btn" name="{{=product.id}}-btnZoomIn" value="+" style="float: right;display:none">
							<input type="button" class="zoom-out-btn" name="{{=product.id}}-btnZoomOut" value="-" style="float: right;display:none">
						</div>
						<div name="{{=product.id}}-cropped" class="cropped" style="display:none"></div>
					</div>				
				</td>
			</tr>
			{{~}}
		</table>		
		
		
	</section>
</section>